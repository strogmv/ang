{{- /* MUI 7.x Form Component Template */ -}}
// ============================================================================
// AUTO-GENERATED by ANG (Architectural Normalized Generator)
// Component: {{ .Name }}Form
// Type: {{ if .IsUpdate }}Update Form (PATCH/PUT){{ else }}Create Form (POST){{ end }}
// DO NOT EDIT - changes will be overwritten on next generation
// ============================================================================

// ============================================================================
// SECTION: Imports
// PURPOSE: React Hook Form for form state, MUI for UI components
// LIBRARIES:
//   - react-hook-form: Form state management and validation
//   - @mui/material: UI components (TextField, Select, etc.)
//   - @mui/x-date-pickers: Date/time picker components
//   - dayjs: Date manipulation library
// ============================================================================
import { Controller } from 'react-hook-form';
import { Box, Button, Stack{{- if .HasTextField }}, TextField{{- end }}{{- if .HasSelect }}, FormControl, InputLabel, Select, MenuItem, FormHelperText{{- end }}{{- if .HasCheckbox }}, Checkbox, FormControlLabel{{- end }}{{- if .HasSwitch }}, Switch, FormControlLabel{{- end }}{{- if .HasCurrency }}, InputAdornment{{- end }}{{- if .HasAutocomplete }}, Autocomplete{{- end }} } from '@mui/material';
{{- if .HasDatePicker }}
import { DatePicker } from '@mui/x-date-pickers/DatePicker';
{{- end }}
{{- if .HasDateTimePicker }}
import { DateTimePicker } from '@mui/x-date-pickers/DateTimePicker';
{{- end }}
{{- if .HasTimePicker }}
import { TimePicker } from '@mui/x-date-pickers/TimePicker';
{{- end }}
{{- if or .HasDatePicker .HasDateTimePicker .HasTimePicker }}
import dayjs from 'dayjs';
{{- end }}
import { use{{ .Name }}Form } from '../../forms';
import { use{{ .Name }} } from '../../hooks';
import type { {{ .InputType }}, {{ .ResponseType }} } from '../../types';
{{- range .CustomImports }}
import { {{ .Component }} } from '{{ .Path }}';
{{- end }}

// ============================================================================
// SECTION: Component Props
// PURPOSE: Define form component interface
// PROPS:
//   - onSuccess: Callback after successful mutation
//   - onError: Callback on mutation error
//   - onCancel: Callback for cancel button
{{- if .IsUpdate }}
//   - defaultValues: Pre-populate form fields for editing
{{- end }}
// ============================================================================
export interface {{ .Name }}FormProps {
  onSuccess?: (data: {{ .ResponseType }}) => void;
  onError?: (error: Error) => void;
  onCancel?: () => void;
{{- if .IsUpdate }}
  defaultValues?: Partial<{{ .InputType }}>;
{{- end }}
}

// ============================================================================
// SECTION: Form Component
// PURPOSE: Render form with controlled inputs and submit handling
// PATTERN: Controller pattern for react-hook-form integration
// MUTATION: use{{ .Name }} hook for API call
// ============================================================================
export function {{ .Name }}Form({ onSuccess, onError, onCancel{{- if .IsUpdate }}, defaultValues{{- end }} }: {{ .Name }}FormProps) {
{{- if and .IsUpdate (or .HasDatePicker .HasDateTimePicker .HasTimePicker) }}
  // Transform date strings to dayjs objects for date pickers
  const transformedDefaults = defaultValues ? {
    ...defaultValues,
    {{- range .Fields }}
    {{- if or (eq .UIType "date") (eq .UIType "datetime") (eq .UIType "time") }}
    ...(defaultValues.{{ .Name }} && { {{ .Name }}: dayjs(defaultValues.{{ .Name }}) }),
    {{- end }}
    {{- end }}
  } : undefined;
  const form = use{{ .Name }}Form({ defaultValues: transformedDefaults });
{{- else }}
  const form = use{{ .Name }}Form({{- if .IsUpdate }}{ defaultValues }{{- end }});
{{- end }}
  const { mutate, isPending } = use{{ .Name }}({
    onSuccess: (data) => onSuccess?.(data),
    onError: (error) => onError?.(error as Error),
  });

  return (
    <Box
      component="form"
      onSubmit={form.handleSubmit((data) => mutate(data))}
      noValidate
    >
      <Stack spacing={3}>
{{- range .Fields }}
{{ template "field" . }}
{{- end }}

        <Stack direction="row" spacing={2} justifyContent="flex-end">
          {onCancel && (
            <Button variant="outlined" onClick={onCancel} disabled={isPending}>
              {{ .CancelLabel | default "Отмена" }}
            </Button>
          )}
          <Button type="submit" variant="contained" disabled={isPending}>
            {isPending ? '{{ .SubmitLoadingLabel | default "Сохранение..." }}' : '{{ .SubmitLabel | default "Сохранить" }}'}
          </Button>
        </Stack>
      </Stack>
    </Box>
  );
}
