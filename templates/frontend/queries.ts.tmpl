// Generated by ANG. Do not edit.
import { queryOptions, infiniteQueryOptions } from '@tanstack/react-query';
import * as Types from '../types';
import { queryKeys } from '../query-keys';
import * as api from '../endpoints';

{{- range .Endpoints }}
{{- if eq .Method "GET" }}
export const {{ LowerFirst .RPC }}QueryOptions = (params: Types.{{ .RPC }}Request = {} as Types.{{ .RPC }}Request) => {
  return queryOptions({
    {{- $res := QueryOptionsResource .RPC }}
    {{- $kind := QueryOptionsKind .RPC }}
    {{- if $res }}
    queryKey: queryKeys.{{ $res }}.{{ $kind }}({{ if eq $kind "detail" }}params.{{ QueryOptionsDetailParam .RPC }}{{ else if eq $kind "me" }}{{ else }}params{{ end }}),
    {{- else }}
    queryKey: ['{{ .ServiceName }}', '{{ .RPC }}', params],
    {{- end }}
    queryFn: async () => {
      return api.{{ LowerFirst .RPC }}(params);
    },
  });
};

{{- if .Pagination }}
export const {{ LowerFirst .RPC }}InfiniteQueryOptions = (params: Types.{{ .RPC }}Request = {} as Types.{{ .RPC }}Request) => {
  return infiniteQueryOptions({
    {{- $res := QueryOptionsResource .RPC }}
    {{- $kind := QueryOptionsKind .RPC }}
    {{- if $res }}
    queryKey: queryKeys.{{ $res }}.{{ $kind }}({{ if eq $kind "detail" }}params.{{ QueryOptionsDetailParam .RPC }}{{ else }}params{{ end }}),
    {{- else }}
    queryKey: ['{{ .ServiceName }}', '{{ .RPC }}', params],
    {{- end }}
    queryFn: async ({ pageParam }: { pageParam: any }) => {
      const p = { ...(params as any) };
      {{- if eq .Pagination.Type "offset" }}
      p.offset = pageParam;
      p.limit = p.limit ?? {{ if .Pagination.DefaultLimit }}{{ .Pagination.DefaultLimit }}{{ else }}20{{ end }};
      {{- else }}
      p.cursor = pageParam;
      {{- end }}
      return api.{{ LowerFirst .RPC }}(p);
    },
    initialPageParam: {{ if eq .Pagination.Type "offset" }}0{{ else }}null{{ end }},
    getNextPageParam: (lastPage: any, allPages: any[]) => {
      {{- if eq .Pagination.Type "offset" }}
      if (!lastPage.data || lastPage.data.length < (params.limit ?? {{ if .Pagination.DefaultLimit }}{{ .Pagination.DefaultLimit }}{{ else }}20{{ end }})) {
        return undefined;
      }
      return allPages.length * (params.limit ?? {{ if .Pagination.DefaultLimit }}{{ .Pagination.DefaultLimit }}{{ else }}20{{ end }});
      {{- else }}
      return lastPage.nextCursor || undefined;
      {{- end }}
    },
  });
};
{{- end }}
{{- end }}
{{- end }}
