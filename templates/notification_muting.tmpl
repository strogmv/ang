package adapter

import (
	"context"

	"{{ GoModule }}/internal/domain"
	"{{ GoModule }}/internal/port"
)

// MutingNotificationRepo is a decorator around NotificationRepository that
// silently skips Save when the target user has muted the notification type.
// Generated by ANG â€” do not edit.
type MutingNotificationRepo struct {
	inner    port.NotificationRepository
	userRepo port.UserRepository
}

// NewMutingNotificationRepo wraps the real notification repo with mute checks.
func NewMutingNotificationRepo(inner port.NotificationRepository, userRepo port.UserRepository) *MutingNotificationRepo {
	return &MutingNotificationRepo{inner: inner, userRepo: userRepo}
}

// Save checks user mute settings before delegating to the inner repository.
func (r *MutingNotificationRepo) Save(ctx context.Context, entity *domain.Notification) error {
	if entity != nil && entity.UserID != "" {
		user, err := r.userRepo.FindByID(ctx, entity.UserID)
		if err == nil && user != nil {
			if user.{{ MuteAllField }} {
				return nil
			}
			for _, t := range user.{{ MutedTypesField }} {
				if t == entity.Type {
					return nil
				}
			}
		}
	}
	return r.inner.Save(ctx, entity)
}

// FindByID delegates to the inner repository.
func (r *MutingNotificationRepo) FindByID(ctx context.Context, id string) (*domain.Notification, error) {
	return r.inner.FindByID(ctx, id)
}

// Delete delegates to the inner repository.
func (r *MutingNotificationRepo) Delete(ctx context.Context, id string) error {
	return r.inner.Delete(ctx, id)
}

// ListAll delegates to the inner repository.
func (r *MutingNotificationRepo) ListAll(ctx context.Context, offset, limit int) ([]domain.Notification, error) {
	return r.inner.ListAll(ctx, offset, limit)
}
{{ range .ExtraFinders }}
// {{ .Name }} delegates to the inner repository.
func (r *MutingNotificationRepo) {{ .Name }}(ctx context.Context{{ if .ParamsSig }}, {{ .ParamsSig }}{{ end }}) ({{ .ReturnType }}, error) {
	return r.inner.{{ .Name }}(ctx{{ if .ArgNames }}, {{ .ArgNames }}{{ end }})
}
{{ end }}
