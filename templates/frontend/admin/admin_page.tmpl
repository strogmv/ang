// Generated by ANG. Do not edit.
import { useState } from 'react';
import { Box, Button, Dialog, DialogContent, DialogTitle, Stack, Typography } from '@mui/material';
import { useQueryClient } from '@tanstack/react-query';
import { {{ .TableComponent }} } from '@sdk/components/tables';
{{- if .HasCreate }}
import { {{ .CreateFormComponent }} } from '@sdk/components/forms';
{{- end }}
{{- if .HasUpdate }}
import { {{ .UpdateFormComponent }} } from '@sdk/components/forms';
{{- end }}
{{- if .HasDelete }}
import { use{{ .DeleteRPC }} } from '@sdk/hooks';
{{- end }}

export default function {{ .ComponentName }}() {
  const queryClient = useQueryClient();
  const [createOpen, setCreateOpen] = useState(false);
  const [editRow, setEditRow] = useState<any | null>(null);

  const invalidateList = () => {
    queryClient.invalidateQueries({ queryKey: ['{{ .ServiceName }}', '{{ .ListRPC }}'] });
  };

{{- if .HasDelete }}
  const { mutate: deleteMutate, isPending: isDeleting } = use{{ .DeleteRPC }}({
    onSuccess: () => invalidateList(),
  });
{{- end }}

  return (
    <Box>
      <Stack direction="row" spacing={2} alignItems="center" justifyContent="space-between" mb={2}>
        <Typography variant="h5">{{ .Title }}</Typography>
{{- if .HasCreate }}
        <Button variant="contained" onClick={() => setCreateOpen(true)}>
          Создать
        </Button>
{{- end }}
      </Stack>

      <{{ .TableComponent }}
{{- if .HasUpdate }}
        onEdit={(row) => setEditRow(row)}
{{- end }}
{{- if .HasDelete }}
        onDelete={(row) => deleteMutate({ {{ .DeleteIDField }}: row.id })}
{{- end }}
      />

{{- if .HasCreate }}
      <Dialog open={createOpen} onClose={() => setCreateOpen(false)} fullWidth maxWidth="md">
        <DialogTitle>Создать</DialogTitle>
        <DialogContent>
          <{{ .CreateFormComponent }}
            onSuccess={() => {
              setCreateOpen(false);
              invalidateList();
            }}
            onCancel={() => setCreateOpen(false)}
          />
        </DialogContent>
      </Dialog>
{{- end }}

{{- if .HasUpdate }}
      <Dialog open={!!editRow} onClose={() => setEditRow(null)} fullWidth maxWidth="md">
        <DialogTitle>Редактировать</DialogTitle>
        <DialogContent>
          {editRow && (
            <{{ .UpdateFormComponent }}
              defaultValues={editRow}
              onSuccess={() => {
                setEditRow(null);
                invalidateList();
              }}
              onCancel={() => setEditRow(null)}
            />
          )}
        </DialogContent>
      </Dialog>
{{- end }}
    </Box>
  );
}
