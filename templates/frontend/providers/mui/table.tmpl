{{- /* MUI 7.x DataGrid Table Template */ -}}
// ============================================================================
// AUTO-GENERATED by ANG (Architectural Normalized Generator)
// Component: {{ .Name }}Table
// Query: use{{ .QueryName }}
// DO NOT EDIT - changes will be overwritten on next generation
// ============================================================================

// ============================================================================
// SECTION: Imports
// PURPOSE: MUI DataGrid for table rendering, React Query for data fetching
// LIBRARIES:
//   - @mui/x-data-grid: Virtualized data table with sorting, pagination
//   - @mui/material: UI components (Avatar, Chip, IconButton, etc.)
//   - dayjs: Date formatting
// ============================================================================
import { useMemo, useState } from 'react';
import { Avatar, Box, Chip, IconButton, Tooltip } from '@mui/material';
import { DataGrid, type GridColDef, type GridPaginationModel, type GridRenderCellParams } from '@mui/x-data-grid';
import { Edit as EditIcon, Delete as DeleteIcon, Visibility as ViewIcon } from '@mui/icons-material';
import dayjs from 'dayjs';
import { use{{ .QueryName }} } from '../../hooks';
{{- range .CustomImports }}
import { {{ .Component }} } from '{{ .Path }}';
{{- end }}

// ============================================================================
// SECTION: Component Props
// PURPOSE: Define table component interface
// PROPS:
//   - onView: View row details callback
//   - onEdit: Edit row callback (opens update form)
//   - onDelete: Delete row callback
// ============================================================================
export interface {{ .Name }}TableProps {
  onView?: (row: any) => void;
  onEdit?: (row: any) => void;
  onDelete?: (row: any) => void;
{{- range .ExtraProps }}
  {{ .Name }}{{ if .Optional }}?{{ end }}: {{ .Type }};
{{- end }}
}

// ============================================================================
// SECTION: Table Component
// PURPOSE: Render paginated data table with action buttons
// PATTERN: MUI DataGrid with useMemo for column definitions
// DATA: Fetched via use{{ .QueryName }} hook (React Query)
// ============================================================================
export function {{ .Name }}Table({ onView, onEdit, onDelete{{- range .ExtraProps }}, {{ .Name }}{{- end }} }: {{ .Name }}TableProps) {
  const [paginationModel, setPaginationModel] = useState<GridPaginationModel>({
    page: 0,
    pageSize: {{ .PageSize | default 25 }},
  });

  const { data, isLoading } = use{{ .QueryName }}({
{{- range .QueryParams }}
    {{ .Name }}: {{ .Value }},
{{- end }}
  });

  const columns = useMemo<GridColDef[]>(() => [
{{- range $i, $col := .Columns }}
    {
      field: '{{ $col.Field }}',
      headerName: '{{ $col.Header }}',
      {{- if $col.Width }}
      width: {{ $col.Width }},
      {{- else if eq $col.Field "id" }}
      width: 100,
      {{- else }}
      minWidth: 120,
      flex: 1,
      {{- end }}
      {{- if $col.Sortable }}
      sortable: true,
      {{- end }}
      {{- if $col.Render }}
      renderCell: (params: GridRenderCellParams) => {{ $col.RenderCode }},
      {{- end }}
    },
{{- end }}
{{- if .HasActions }}
    {
      field: 'actions',
      headerName: 'Действия',
      width: 120,
      sortable: false,
      renderCell: (params: GridRenderCellParams) => (
        <Box>
          {onView && (
            <Tooltip title="Просмотр">
              <IconButton size="small" onClick={() => onView(params.row)}>
                <ViewIcon fontSize="small" />
              </IconButton>
            </Tooltip>
          )}
          {onEdit && (
            <Tooltip title="Редактировать">
              <IconButton size="small" onClick={() => onEdit(params.row)}>
                <EditIcon fontSize="small" />
              </IconButton>
            </Tooltip>
          )}
          {onDelete && (
            <Tooltip title="Удалить">
              <IconButton size="small" onClick={() => onDelete(params.row)}>
                <DeleteIcon fontSize="small" color="error" />
              </IconButton>
            </Tooltip>
          )}
        </Box>
      ),
    },
{{- end }}
  ], [onView, onEdit, onDelete]);

  return (
    <Box sx={{"{{"}} width: '100%', overflowX: 'auto' {{"}}"}}>
      <DataGrid
        rows={data?.data ?? []}
        columns={columns}
        loading={isLoading}
        paginationModel={paginationModel}
        onPaginationModelChange={setPaginationModel}
        pageSizeOptions={[10, 25, 50, 100]}
        disableRowSelectionOnClick
        autoHeight
        sx={{"{{"}} minWidth: 800 {{"}}"}}
      />
    </Box>
  );
}
