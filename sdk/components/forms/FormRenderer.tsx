// AUTO-GENERATED by ANG. DO NOT EDIT.
import { useEffect, useMemo, useState } from 'react';
import { AutoForm } from '@/components/ui/auto-form';
import type { FormSchema } from '@/components/ui/auto-form';
import * as Hooks from '../../hooks';
import * as FormHooks from '../../forms';
import { resolveFormEntry, type GeneratedFormName } from './forms.manifest';

export type FormRendererProps = {
  formName: GeneratedFormName;
  onSuccess?: (data: any) => void;
  onError?: (error: Error) => void;
  onCancel?: () => void;
  defaultValues?: Record<string, unknown>;
  fallback?: JSX.Element | null;
};

export function FormRenderer({ formName, onSuccess, onError, onCancel, defaultValues, fallback = null }: FormRendererProps) {
  const entry = useMemo(() => resolveFormEntry(formName), [formName]);
  const [schema, setSchema] = useState<FormSchema<any> | null>(null);
  const [loadErr, setLoadErr] = useState<Error | null>(null);
  useEffect(() => {
    let active = true;
    setSchema(null);
    setLoadErr(null);
    entry.loadSchema().then((next) => {
      if (!active) return;
      setSchema(next);
    }).catch((e) => {
      if (!active) return;
      setLoadErr(e as Error);
    });
    return () => { active = false; };
  }, [entry]);
  const useForm = (FormHooks as any)[entry.useFormHook];
  const useMutation = (Hooks as any)[entry.useMutationHook];
  if (typeof useForm !== 'function' || typeof useMutation !== 'function') {
    throw new Error(`ANG FormRenderer: hooks are not resolved for form ${formName}`);
  }
  if (loadErr) throw loadErr;
  if (!schema) return fallback;
  const form = useForm(defaultValues ? { defaultValues } : undefined);
  const { mutate, isPending } = useMutation({
    onSuccess: (data: any) => onSuccess?.(data),
    onError: (error: any) => onError?.(error as Error),
  });
  return (
    <AutoForm
      form={form}
      schema={schema}
      onSubmit={(data) => mutate(data)}
      isPending={isPending}
      onCancel={onCancel}
    />
  );
}
