# ANG Project Context

AI-Friendly Intent Compiler for Go Backends.

## Core Policy
**Agent writes ONLY CUE intent in `cue/` folder.**

**NEVER edit generated files directly.**
Generated outputs are overwritten on next build.

Read-only for AI:
- `internal/`
- `api/`
- `sdk/`
- `db/schema/`
- `db/queries/`

If a bug appears in generated code, fix CUE intent instead:
- `ang_do(intent="fix: <bug description>")`

If adding/changing behavior or API:
- `ang_do(intent="add: <feature description>")`

If `ang_do` is unavailable, use MCP toolchain only:
- `ang_plan` -> `cue_apply_patch` -> `run_preset('build')` -> `ang_doctor` (if needed)

## Pre-Tool Write Interceptor (Guardrail)
Before any file write/edit, check target path.

If target is under generated paths:
- `internal/`
- `api/`
- `sdk/`
- `db/schema/`
- `db/queries/`

Do NOT apply the write directly.  
Return a guidance message (non-blocking) and switch to intent workflow.

Required guidance message format:
`This file is generated by ANG. To change it, modify CUE intent instead. Suggested CUE change: <short suggestion>.`

Then proceed with:
1. `ang_do(intent="fix: <bug description>")` for bug fixes
2. `ang_do(intent="add: <feature description>")` for feature work

Fallback when `ang_do` is unavailable:
1. `ang_plan`
2. `cue_apply_patch`
3. `run_preset('build')`
4. `ang_doctor` (if build fails)

## Development Commands
- `ang build` - Standard generation (use via `ang_generate` tool in MCP)
- `ang validate` - Check CUE integrity
- `go test ./...` - Run tests

## MCP Tools
This project supports Model Context Protocol. Run `ang mcp` to start the server.
Available tools:
- `cue_apply_patch`: Edit CUE intent
- `ang_generate`: Rebuild the whole project from CUE
- `repo_diff`: Token-efficient way to see changes in Go code

## Code Style
- CUE: Strict schema validation via `cue/schema`
- Go: Standard library preferred, clean architecture (ports and adapters)
