// ============================================================================
// AUTO-GENERATED by ANG (Architectural Normalized Generator)
// Version: 0.1.82
// InputHash: c512a5349e78b6ec2b981dae1900e24fdecd5fb628dcf797d5030b1fee38380f
// CompilerHash: c3fb900bcf4a303db1bd1e04238e5eaf59531dcb088354b4221baf991436313c
// DO NOT EDIT - changes will be overwritten on next generation
// GENERATED: true
// ============================================================================

// Package domain contains domain entities and business logic.
package domain

import (
	"fmt"
	"log/slog"
	"time"
)

// Post represents the domain entity.
// Source: cue/domain/entities.cue:87
type Post struct {
	// Source: cue/domain/entities.cue:93
	ID string `json:"ID"`
	// Source: cue/domain/entities.cue:97
	AuthorID string `json:"authorId"`
	// Source: cue/domain/entities.cue:102
	Title string `json:"title"`
	// Source: cue/domain/entities.cue:107
	Slug string `json:"slug"`
	// Source: cue/domain/entities.cue:112
	Content string `json:"content"`
	// Source: cue/domain/entities.cue:117
	Excerpt string `json:"excerpt"`
	// Source: cue/domain/entities.cue:122
	Status string `json:"status"`
	// Source: cue/domain/entities.cue:127
	PublishedAt time.Time `json:"publishedAt"`
	// Source: cue/domain/entities.cue:132
	ViewCount int `json:"viewCount"`
	// Source: cue/domain/entities.cue:137
	CreatedAt time.Time `json:"createdAt"`
	// Source: cue/domain/entities.cue:141
	UpdatedAt time.Time `json:"updatedAt"`
}

func (e *Post) Validate() error {
	return nil
}

// LogValue implements slog.LogValuer interface.
// It automatically masks fields marked as @secret or @pii.
func (e *Post) LogValue() slog.Value {
	return slog.GroupValue(
		slog.Any("ID", e.ID),
		slog.Any("authorId", e.AuthorID),
		slog.Any("title", e.Title),
		slog.Any("slug", e.Slug),
		slog.Any("content", e.Content),
		slog.Any("excerpt", e.Excerpt),
		slog.Any("status", e.Status),
		slog.Any("publishedAt", e.PublishedAt),
		slog.Any("viewCount", e.ViewCount),
		slog.Any("createdAt", e.CreatedAt),
		slog.Any("updatedAt", e.UpdatedAt),
	)
}

const (
	PostStatusApproved   = "approved"
	PostStatusPending    = "pending"
	PostStatusRejected   = "rejected"
	PostStatusFromInvite = "from_invite"
	PostStatusInProgress = "in_progress"
	PostStatusLive       = "live"
	PostStatusClosed     = "closed"
)

// NewPost creates a new instance of Post with default values.
func NewPost() *Post {
	return &Post{}
}

// CanTransitionTo checks if the state transition is allowed.
func (e *Post) CanTransitionTo(target string) bool {
	switch e.Status {
	case "archived":
		return target == "draft"
	case "draft":
		return target == "review"
	case "published":
		return target == "archived"
	case "review":
		return target == "draft" || target == "published"
	}
	return false
}

// TransitionTo performs the state transition.
func (e *Post) TransitionTo(target string) error {
	if !e.CanTransitionTo(target) {
		return fmt.Errorf("invalid transition from %s to %s", e.Status, target)
	}
	e.Status = target
	return nil
}
