// AUTO-GENERATED by ANG
import type { QueryClient } from '@tanstack/react-query';
import type { LoaderFunctionArgs } from 'react-router-dom';
import * as Options from '../query-options';
{{- if .QueryOptionsNeedsTypes }}
import type * as Types from '../types';
{{- end }}

{{- range .QueryResources }}
{{- $name := ExportName .Key }}
{{- if .HasList }}
export const prefetch{{ $name }}List = (queryClient: QueryClient, filters?: Types.{{ .ListRPC }}Request) =>
  queryClient.prefetchQuery(Options.{{ .Key }}Options.list(filters));

export const create{{ $name }}ListLoader = (queryClient: QueryClient) =>
  async ({ request }: LoaderFunctionArgs) => {
    const url = new URL(request.url);
    const filters = Object.fromEntries(url.searchParams) as Types.{{ .ListRPC }}Request;
    await prefetch{{ $name }}List(queryClient, filters);
    return null;
  };

{{- end }}
{{- if .HasDetail }}
export const prefetch{{ $name }}Detail = (queryClient: QueryClient, {{ .DetailParamName }}: string) =>
  queryClient.prefetchQuery(Options.{{ .Key }}Options.detail({{ .DetailParamName }}));

export const create{{ $name }}DetailLoader = (queryClient: QueryClient) =>
  async ({ params }: LoaderFunctionArgs) => {
    const {{ .DetailParamName }} = params.{{ .DetailParamName }};
    if (!{{ .DetailParamName }}) {
      throw new Error('{{ $name }} ID required');
    }
    await prefetch{{ $name }}Detail(queryClient, {{ .DetailParamName }});
    return null;
  };

{{- end }}
{{- if .HasMe }}
export const prefetch{{ $name }}Me = (queryClient: QueryClient) =>
  queryClient.prefetchQuery(Options.{{ .Key }}Options.me());

{{- end }}
{{- end }}
