// Generated by ANG. Do not edit.
export type InvalidateTarget = {
  store: string;
  scopeParam?: string;
  mode?: 'list' | 'detail' | 'aggregate';
};

type ScopedInvalidateFn = (target: InvalidateTarget, params?: unknown) => void;

const storeInvalidators = new Map<string, ScopedInvalidateFn>();

export const registerStoreInvalidator = (storeKey: string, fn: ScopedInvalidateFn) => {
  if (!storeKey || typeof fn !== 'function') return;
  storeInvalidators.set(storeKey, fn);
};

export const markStoreListStale = (storeKey: string) => {
  const fn = storeInvalidators.get(storeKey);
  if (fn) fn({ store: storeKey, mode: 'list' });
};

export const markStoresListStale = (storeKeys: string[]) => {
  const seen = new Set<string>();
  for (const key of storeKeys || []) {
    if (!key || seen.has(key)) continue;
    seen.add(key);
    markStoreListStale(key);
  }
};

export const markInvalidateTargets = (targets: InvalidateTarget[], _params?: unknown) => {
  const seen = new Set<string>();
  for (const target of targets || []) {
    if (!target?.store) continue;
    const key = `${target.store}|${target.scopeParam || ''}|${target.mode || 'list'}`;
    if (seen.has(key)) continue;
    seen.add(key);
    const fn = storeInvalidators.get(target.store);
    if (!fn) continue;
    fn(target, _params);
  }
};
