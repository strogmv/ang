asyncapi: '2.6.0'
info:
  title: {{ .Title }}
  version: '{{ .Version }}'
  x-ang-version: {{ .ANGVersion }}
  x-ang-input-hash: {{ .InputHash }}
  x-ang-compiler-hash: {{ .CompilerHash }}
  description: Event-Driven Architecture documentation generated by ANG.

servers:
  nats:
    url: nats://localhost:4222
    protocol: nats

channels:
{{- range .Events }}
  {{ .Name }}:
    description: Channel for {{ .Name }} events
    publish:
      message:
        $ref: '#/components/messages/{{ .Name }}'
    subscribe:
      message:
        $ref: '#/components/messages/{{ .Name }}'
{{- end }}

components:
  messages:
{{- range .Events }}
    {{ .Name }}:
      name: {{ .Name }}
      title: {{ .Name }}
      payload:
        type: object
        properties:
{{- range .Fields }}
          {{ .Name | ToLower }}:
            type: {{ AsyncApiType .Type }}
{{- end }}
{{- end }}
