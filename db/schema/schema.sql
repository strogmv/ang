-- System Tables for Outbox and Idempotency
CREATE TABLE IF NOT EXISTS outbox_events (
    id UUID PRIMARY KEY,
    event_type TEXT NOT NULL,
    payload JSONB NOT NULL,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMPTZ
);
CREATE INDEX IF NOT EXISTS idx_outbox_unprocessed ON outbox_events (created_at) WHERE processed_at IS NULL;

CREATE TABLE IF NOT EXISTS idempotency_keys (
    key TEXT PRIMARY KEY,
    response_payload JSONB,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMPTZ
);


-- Auto-generated by ANG. Do not edit manually.

CREATE TABLE IF NOT EXISTS comments (
    "id" TEXT NOT NULL,
    "postid" TEXT NOT NULL,
    "authorid" TEXT NOT NULL,
    "parentid" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "createdat" TEXT NOT NULL,
    "updatedat" TEXT NOT NULL
);


-- Auto-generated by ANG. Do not edit manually.

CREATE TABLE IF NOT EXISTS posts (
    "id" TEXT NOT NULL,
    "authorid" TEXT NOT NULL,
    "title" TEXT NOT NULL,
    "slug" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "excerpt" TEXT NOT NULL,
    "status" TEXT NOT NULL,
    "publishedat" TEXT NOT NULL,
    "viewcount" TEXT NOT NULL,
    "createdat" TEXT NOT NULL,
    "updatedat" TEXT NOT NULL
);


-- Auto-generated by ANG. Do not edit manually.

CREATE TABLE IF NOT EXISTS tags (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "slug" TEXT NOT NULL,
    "description" TEXT NOT NULL
);


-- Auto-generated by ANG. Do not edit manually.

CREATE TABLE IF NOT EXISTS users (
    "id" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "passwordhash" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "role" TEXT NOT NULL,
    "avatarurl" TEXT NOT NULL,
    "createdat" TEXT NOT NULL,
    "updatedat" TEXT NOT NULL
);


-- Auto-generated by ANG. Do not edit manually.

CREATE TABLE IF NOT EXISTS uservaults (
    "id" TEXT NOT NULL,
    "personalkey" TEXT NOT NULL,
    "bio" TEXT
);


