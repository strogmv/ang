// ============================================================================
// AUTO-GENERATED by ANG (Architectural Normalized Generator)
// Version: {{ ANGVersion }}
// InputHash: {{ InputHash }}
// CompilerHash: {{ CompilerHash }}
// DO NOT EDIT - changes will be overwritten on next generation
// GENERATED: true
// ============================================================================

package port

//go:generate go run go.uber.org/mock/mockgen@latest -source=$GOFILE -destination=mocks/mock_$GOFILE -package=mocks

import (
	"context"
	"log/slog"
	{{- if HasConstraints . }}
	"fmt"
	{{- end }}
	{{- if or (HasEventMethods .) (HasDomainTypes .) }}
	"{{GoModule}}/internal/domain"
	{{- end }}
)

{{- define "validator" }}
func (d *{{ .Name }}) Validate() error {
	{{- range .Fields }}
	{{- if .Constraints }}
	{{- if .Constraints.Min }}
	if d.{{ ExportName .Name }} < {{ .Constraints.Min }} {
		return fmt.Errorf("field {{ JSONName .Name }} must be >= %v", {{ .Constraints.Min }})
	}
	{{- end }}
	{{- if .Constraints.Max }}
	if d.{{ ExportName .Name }} > {{ .Constraints.Max }} {
		return fmt.Errorf("field {{ JSONName .Name }} must be <= %v", {{ .Constraints.Max }})
	}
	{{- end }}
	{{- if .Constraints.MinLen }}
	if len(d.{{ ExportName .Name }}) < {{ .Constraints.MinLen }} {
		return fmt.Errorf("field {{ JSONName .Name }} length must be >= %v", {{ .Constraints.MinLen }})
	}
	{{- end }}
	{{- if .Constraints.MaxLen }}
	if len(d.{{ ExportName .Name }}) > {{ .Constraints.MaxLen }} {
		return fmt.Errorf("field {{ JSONName .Name }} length must be <= %v", {{ .Constraints.MaxLen }})
	}
	{{- end }}
	{{- if .Constraints.Enum }}
	{
		valid := false
		allowed := []string{ {{- range $i, $v := .Constraints.Enum }}{{ if $i }}, {{ end }}"{{ $v }}"{{ end }} }
		for _, v := range allowed {
			if d.{{ ExportName .Name }} == v {
				valid = true
				break
			}
		}
		if !valid {
			return fmt.Errorf("field {{ JSONName .Name }} must be one of %v", allowed)
		}
	}
	{{- end }}
	{{- end }}
	{{- end }}
	return nil
}
{{- end }}

{{- define "log_valuer" }}
// LogValue implements slog.LogValuer interface.
func (e {{ .Name }}) LogValue() slog.Value {
	return slog.GroupValue(
		{{- range .Fields }}
		{{- if .IsSecret }}
		slog.String("{{ JSONName .Name }}", "***"),
		{{- else if .IsPII }}
		slog.String("{{ JSONName .Name }}", "[PII]"),
		{{- else }}
		slog.Any("{{ JSONName .Name }}", e.{{ ExportName .Name }}),
		{{- end }}
		{{- end }}
	)
}
{{- end }}

{{- if .Description }}
// {{ .Name }} {{ .Description }}
{{- else }}
// {{ .Name }} defines the service interface.
{{- end }}
{{ ServiceInterfaceDecl . }}

// Request/Response DTOs
{{- range .Methods }}
{{- if not (EventForMethod $ .) }}
// {{ .Input.Name }}
{{- if .Input.Source }}
// Source: {{ .Input.Source }}
{{- end }}
type {{ .Input.Name }} struct {
	{{- range .Input.Fields }}
	{{- $tag := FieldValidateTag . }}
	{{- if .Source }}
	// Source: {{ .Source }}
	{{- end }}
	{{ .Name | ExportName }} {{ .Type }} `json:"{{ JSONName .Name }}"{{ if $tag }} validate:"{{ $tag }}"{{ end }}`
	{{- end }}
}
{{ template "log_valuer" .Input }}
{{ template "validator" .Input }}
{{- end }}
{{- if and .Output.Name (not (EventForMethod $ .)) }}
// {{ .Output.Name }}
{{- if .Output.Source }}
// Source: {{ .Output.Source }}
{{- end }}
type {{ .Output.Name }} struct {
	{{- range .Output.Fields }}
	{{- $tag := FieldValidateTag . }}
	{{- if .Source }}
	// Source: {{ .Source }}
	{{- end }}
	{{ .Name | ExportName }} {{ .Type }} `json:"{{ JSONName .Name }}"{{ if $tag }} validate:"{{ $tag }}"{{ end }}`
	{{- end }}
}
{{ template "log_valuer" .Output }}
{{ template "validator" .Output }}
{{- end }}
{{- end }}

{{- range ServiceNestedTypes . }}
type {{ .Name }} struct {
	{{- range .Fields }}
	{{- $tag := FieldValidateTag . }}
	{{ .Name | ExportName }} {{ .Type }} `json:"{{ JSONName .Name }}"{{ if $tag }} validate:"{{ $tag }}"{{ end }}`
	{{- end }}
}
{{ template "log_valuer" . }}
{{ template "validator" . }}
{{- end }}
