// AUTO-GENERATED by ANG
import { apiClient, validateResponse } from './api-client';
import * as Types from './types';

{{- range .Endpoints }}
{{- if ne .Method "WS" }}
{{- $argList := PathArgNames .Path }}
export const {{ LowerFirst .RPC }} = (params: Types.{{ .RPC }}Request = {} as Types.{{ .RPC }}Request) => {
  {{- if gt (len $argList) 0 }}
  // @ts-ignore
  {{- range $argList }}
  {{- if eq . (JSONName .) }}
  const {{ . }} = (params as any)?.{{ . }};
  {{- else }}
  const {{ . }} = (params as any)?.{{ . }} ?? (params as any)?.{{ JSONName . }};
  {{- end }}
  {{- end }}
  {{- end }}
  {{- if eq .Method "GET" }}
  const queryParams = { ...params } as any;
  {{- range $argList }}
  delete queryParams.{{ . }};
  {{- if ne . (JSONName .) }}
  delete queryParams.{{ JSONName . }};
  {{- end }}
  {{- end }}
  return apiClient.get<Types.{{ .RPC }}Response>(`{{ PathTemplate .Path }}`, { params: queryParams }).then((r) =>
    validateResponse('{{ .RPC }}ResponseSchema', r.data, '{{ .RPC }}')
  );
  {{- else if eq .Method "DELETE" }}
  return apiClient.delete<Types.{{ .RPC }}Response>(`{{ PathTemplate .Path }}`, { data: params }).then((r) =>
    validateResponse('{{ .RPC }}ResponseSchema', r.data, '{{ .RPC }}')
  );
  {{- else }}
  return apiClient.{{ .Method | ToLower }}<Types.{{ .RPC }}Response>(`{{ PathTemplate .Path }}`, params).then((r) =>
    validateResponse('{{ .RPC }}ResponseSchema', r.data, '{{ .RPC }}')
  );
  {{- end }}
};

{{- end }}
{{- end }}

export const endpointMeta: Record<string, {
  method: string;
  path: string;
  idempotent?: boolean;
  timeout?: string;
  authRoles?: string[];
  cacheTTL?: string;
}> = {
{{- range .Endpoints }}
{{- if ne .Method "WS" }}
  {{ LowerFirst .RPC }}: {
    method: '{{ .Method }}',
    path: '{{ .Path }}',
    {{- if .Idempotency }}
    idempotent: true,
    {{- end }}
    {{- if .Timeout }}
    timeout: '{{ .Timeout }}',
    {{- end }}
    {{- if .AuthRoles }}
    authRoles: [{{- range $i, $r := .AuthRoles }}{{ if $i }}, {{ end }}'{{ $r }}'{{- end }}],
    {{- end }}
    {{- if .CacheTTL }}
    cacheTTL: '{{ .CacheTTL }}',
    {{- end }}
  },
{{- end }}
{{- end }}
};
